# Чек-лист по исправлению ошибок Postman-тестов (ТЗ)

## Важно! Что нельзя делать
- [ ] Не использовать костыли и хаки ради прохождения тестов.
- [ ] Не нарушать best practices Django/DRF.
- [ ] Не дублировать логику (валидация только в сериализаторах, а не во view).
- [ ] Не менять структуру моделей и базу данных без необходимости.
- [ ] Не игнорировать обработку ошибок и статусы ответов.
- [ ] Не использовать магические значения и хардкод.

## Best practices (что обязательно соблюдать)
- [ ] Вся валидация — в сериализаторах.
- [ ] Все проверки прав — через permissions.
- [ ] Использовать стандартные механизмы DRF (APIView, ViewSet, permissions, status).
- [ ] Структура ошибок и ответов — строго по документации и автотестам.
- [ ] Код должен быть читаемым, поддерживаемым, покрыт тестами.

---

## Чек-лист по исправлению (по результатам Postman и redoc.yaml)

### AUTH
#### /api/v1/auth/signup/
- [ ] POST: Регистрация пользователя возвращает 200 с правильной структурой (email, username).
- [ ] Username "me" запрещён (400).
- [ ] Username/email не могут быть пустыми.
- [ ] Username/email должны быть уникальными.
- [ ] Слишком длинные username/email возвращают 400.
- [ ] При попытке зарегистрировать пользователя с уже существующим username/email возвращается 400 с корректной структурой ошибки.

#### /api/v1/auth/token/
- [ ] POST: По валидному username и confirmation_code возвращается токен (200, {"token": ...}).
- [ ] По невалидным данным — 400 с ошибкой по полю.
- [ ] Если username не существует — 404 с ошибкой по username.


### Ошибки Postman-тестов (AUTH)

- /api/v1/auth/signup/
  - [ ] Если username уже занят ("username_in_use"), возвращается 400, но структура ошибки не соответствует ожидаемой (ожидается {'username': [...]}, а не общая ошибка или другая структура).
  - [ ] Если username и email оба заняты разными пользователями ("username_and_email_both_in_use_by_different_users"), возвращается 400, но структура ошибки не соответствует ожидаемой (ожидается {'email': [...]}, а не общая ошибка или другая структура).

- /api/v1/auth/token/
  - [ ] Для всех пользователей (superuser, regular user, admin, moderator) при попытке получить токен возвращается 400, ожидался 200 и структура ответа {'token': ...} ("get_token_for_superuser", "get_token_for_regular_user", "get_token_for_admin", "get_token_for_moderator").
  - [ ] Структура ответа при ошибке не соответствует ожидаемой (ожидается {'confirmation_code': [...]}, если код неверный, или {'username': [...]}, если пользователь не найден).

---

---

### USERS
#### /api/v1/users/
- [ ] GET: Только админ может получить список пользователей (200).
- [ ] POST: Только админ может создавать пользователей (201).
- [ ] Обычный пользователь и модератор получают 403 при попытке доступа к этим действиям.
- [ ] Неавторизованный пользователь получает 401.
- [ ] POST с невалидными/дублирующимися/пустыми/слишком длинными username/email — 400 с корректной структурой ошибки.
- [ ] POST с username="me" — 400.
- [ ] POST с невалидным username — 400.

#### /api/v1/users/{username}/
- [ ] GET: Только админ может получить пользователя по username (200).
- [ ] PATCH: Только админ может изменять пользователя (200).
- [ ] DELETE: Только админ может удалять пользователя (204).
- [ ] PATCH/DELETE/GET для несуществующего пользователя — 404.
- [ ] PATCH с невалидными/дублирующимися/пустыми/слишком длинными username/email — 400.
- [ ] PATCH с username="me" — 400.
- [ ] PATCH с невалидным username — 400.
- [ ] PATCH с попыткой изменить роль обычным пользователем — 403 или игнорируется.
- [ ] PUT не разрешён (405) для обновления пользователя.

#### /api/v1/users/me/
- [ ] GET: Любой авторизованный пользователь может получить свои данные (200).
- [ ] PATCH: Любой авторизованный пользователь может изменить свои данные (200).
- [ ] PATCH с невалидными/дублирующимися/пустыми/слишком длинными username/email — 400.
- [ ] PATCH с username="me" — 400.
- [ ] PATCH с невалидным username — 400.
- [ ] PATCH с попыткой изменить роль обычным пользователем — 403 или игнорируется.

---

### Ошибки Postman-тестов (USERS)

- /api/v1/users/
  - [ ] Неавторизованный пользователь (401) не может получить список пользователей, создать пользователя, изменить или удалить пользователя (ожидался 401, иногда 403 или другой статус).
  - [ ] Обычный пользователь и модератор получают 401 вместо 403 при попытке доступа к действиям для админа (GET, POST, PATCH, DELETE).
  - [ ] POST с невалидными/дублирующимися/пустыми/слишком длинными username/email — не всегда 400 или структура ошибки не соответствует ожидаемой.
  - [ ] PATCH/DELETE/GET для несуществующего пользователя — не всегда 404.
  - [ ] PUT не разрешён (405), но иногда возвращается другой статус.
  - [ ] PATCH с попыткой изменить роль обычным пользователем — не всегда 403 или роль меняется.

- /api/v1/users/me/
  - [ ] Неавторизованный пользователь (401) не может получить или изменить свои данные.
  - [ ] PATCH с невалидными/дублирующимися/пустыми/слишком длинными username/email — не всегда 400.
  - [ ] PATCH с username="me" — не всегда 400.
  - [ ] PATCH с попыткой изменить роль обычным пользователем — не всегда 403 или роль меняется.

---

### CATEGORIES
#### /api/v1/categories/
- [ ] GET: Доступен без токена (200).
- [ ] POST: Только админ может создавать категории (201).
- [ ] POST с невалидными/дублирующимися/пустыми/слишком длинными полями — 400.
- [ ] Неавторизованный пользователь получает 401.
- [ ] Обычный пользователь и модератор получают 403 при попытке доступа к POST.
- [ ] PUT не разрешён (405) для обновления категорий.

#### /api/v1/categories/{slug}/
- [ ] DELETE: Только админ может удалять категории (204).
- [ ] DELETE для несуществующего объекта — 404.
- [ ] Неавторизованный пользователь получает 401.
- [ ] Обычный пользователь и модератор получают 403 при попытке доступа к DELETE.

---

### Ошибки Postman-тестов (CATEGORIES)

- /api/v1/categories/
  - [ ] Неавторизованный пользователь (401) не может создавать или удалять категории.
  - [ ] Обычный пользователь и модератор получают 401 вместо 403 при попытке доступа к POST/DELETE.
  - [ ] POST с невалидными/дублирующимися/пустыми/слишком длинными полями — не всегда 400 или структура ошибки не соответствует ожидаемой.
  - [ ] PUT/PATCH не разрешён (405), но иногда возвращается другой статус.

- /api/v1/categories/{slug}/
  - [ ] DELETE для несуществующего объекта — не всегда 404.

---

### GENRES
#### /api/v1/genres/
- [ ] GET: Доступен без токена (200).
- [ ] POST: Только админ может создавать жанры (201).
- [ ] POST с невалидными/дублирующимися/пустыми/слишком длинными полями — 400.
- [ ] Неавторизованный пользователь получает 401.
- [ ] Обычный пользователь и модератор получают 403 при попытке доступа к POST.
- [ ] PUT не разрешён (405) для обновления жанров.

#### /api/v1/genres/{slug}/
- [ ] DELETE: Только админ может удалять жанры (204).
- [ ] DELETE для несуществующего объекта — 404.
- [ ] Неавторизованный пользователь получает 401.
- [ ] Обычный пользователь и модератор получают 403 при попытке доступа к DELETE.

---

### Ошибки Postman-тестов (GENRES)

- /api/v1/genres/
  - [ ] Неавторизованный пользователь (401) не может создавать или удалять жанры.
  - [ ] Обычный пользователь и модератор получают 401 вместо 403 при попытке доступа к POST/DELETE.
  - [ ] POST с невалидными/дублирующимися/пустыми/слишком длинными полями — не всегда 400 или структура ошибки не соответствует ожидаемой.
  - [ ] PUT/PATCH не разрешён (405), но иногда возвращается другой статус.

- /api/v1/genres/{slug}/
  - [ ] DELETE для несуществующего объекта — не всегда 404.

---

### TITLES
#### /api/v1/titles/
- [ ] GET: Доступен без токена (200).
- [ ] POST: Только админ может создавать произведения (201).
- [ ] POST с невалидными/дублирующимися/пустыми/слишком длинными полями — 400.
- [ ] POST: Год выпуска не может быть больше текущего.
- [ ] POST: Требуется указать существующие категорию и жанр.
- [ ] Неавторизованный пользователь получает 401.
- [ ] Обычный пользователь и модератор получают 403 при попытке доступа к POST.
- [ ] PUT не разрешён (405) для обновления произведений.

#### /api/v1/titles/{title_id}/
- [ ] GET: Доступен без токена (200).
- [ ] PATCH: Только админ может изменять произведение (200).
- [ ] PATCH с невалидными/дублирующимися/пустыми/слишком длинными полями — 400.
- [ ] PATCH: Год выпуска не может быть больше текущего.
- [ ] PATCH: Требуется указать существующие категорию и жанр.
- [ ] DELETE: Только админ может удалять произведение (204).
- [ ] PATCH/DELETE/GET для несуществующего объекта — 404.
- [ ] Неавторизованный пользователь получает 401.
- [ ] Обычный пользователь и модератор получают 403 при попытке доступа к PATCH/DELETE.

---

### Ошибки Postman-тестов (TITLES)

- /api/v1/titles/
  - [ ] Неавторизованный пользователь (401) не может создавать или изменять произведения.
  - [ ] Обычный пользователь и модератор получают 401 вместо 403 при попытке доступа к POST/PATCH/DELETE.
  - [ ] POST с невалидными/дублирующимися/пустыми/слишком длинными полями — не всегда 400 или структура ошибки не соответствует ожидаемой.
  - [ ] POST: Год выпуска больше текущего — не всегда 400.
  - [ ] POST: Требуется указать существующие категорию и жанр — не всегда 400.
  - [ ] PUT/PATCH не разрешён (405), но иногда возвращается другой статус.

- /api/v1/titles/{title_id}/
  - [ ] PATCH/DELETE/GET для несуществующего объекта — не всегда 404.

---

### REVIEWS
#### /api/v1/titles/{title_id}/reviews/
- [ ] GET: Доступен без токена (200).
- [ ] POST: Только авторизованный пользователь может создать отзыв (201).
- [ ] POST: Один пользователь может оставить только один отзыв на произведение.
- [ ] POST с невалидными/пустыми/слишком длинными полями — 400.
- [ ] POST для несуществующего произведения — 404.
- [ ] Неавторизованный пользователь получает 401.

#### /api/v1/titles/{title_id}/reviews/{review_id}/
- [ ] GET: Доступен без токена (200).
- [ ] PATCH: Только автор/модератор/админ может изменять отзыв (200).
- [ ] DELETE: Только автор/модератор/админ может удалять отзыв (204).
- [ ] PATCH/DELETE/GET для несуществующего объекта — 404.
- [ ] PATCH/POST/PUT/DELETE с невалидными/пустыми/слишком длинными полями — 400.
- [ ] Неавторизованный пользователь получает 401.
- [ ] Обычный пользователь получает 403 при попытке изменить/удалить чужой отзыв.

---

### Ошибки Postman-тестов (REVIEWS)

- /api/v1/titles/{title_id}/reviews/
  - [ ] Неавторизованный пользователь (401) не может создавать отзывы.
  - [ ] POST: Один пользователь может оставить только один отзыв на произведение — не всегда 400.
  - [ ] POST с невалидными/пустыми/слишком длинными полями — не всегда 400.
  - [ ] POST для несуществующего произведения — не всегда 404.

- /api/v1/titles/{title_id}/reviews/{review_id}/
  - [ ] PATCH/DELETE/GET для несуществующего объекта — не всегда 404.
  - [ ] PATCH/POST/PUT/DELETE с невалидными/пустыми/слишком длинными полями — не всегда 400.
  - [ ] Обычный пользователь получает 401 или 403 при попытке изменить/удалить чужой отзыв, но иногда другой статус.

---

### COMMENTS
#### /api/v1/titles/{title_id}/reviews/{review_id}/comments/
- [ ] GET: Доступен без токена (200).
- [ ] POST: Только авторизованный пользователь может создать комментарий (201).
- [ ] POST с невалидными/пустыми/слишком длинными полями — 400.
- [ ] POST для несуществующего произведения/отзыва — 404.
- [ ] Неавторизованный пользователь получает 401.

#### /api/v1/titles/{title_id}/reviews/{review_id}/comments/{comment_id}/
- [ ] GET: Доступен без токена (200).
- [ ] PATCH: Только автор/модератор/админ может изменять комментарий (200).
- [ ] DELETE: Только автор/модератор/админ может удалять комментарий (204).
- [ ] PATCH/DELETE/GET для несуществующего объекта — 404.
- [ ] PATCH/POST/PUT/DELETE с невалидными/пустыми/слишком длинными полями — 400.
- [ ] Неавторизованный пользователь получает 401.
- [ ] Обычный пользователь получает 403 при попытке изменить/удалить чужой комментарий.

---



**Выполнять исправления строго по этому чек-листу и документации redoc.yaml!**